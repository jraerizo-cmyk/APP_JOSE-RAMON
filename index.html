<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <!-- Evitar zoom en inputs en m√≥vil a√±adiendo maximum-scale y user-scalable=no -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <meta name="theme-color" content="#007C59"/>
  <title>MEDICAMENTOS SIN EXISTENCIAS ‚Äî v15 m√≥vil</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-size: 17px;           /* Letra un poco m√°s grande en todo el sistema */
      overflow-x: hidden;        /* Evita desplazamiento horizontal en m√≥vil */
    }
    body {
      -webkit-tap-highlight-color: transparent;
    }
    #root {
      min-height: 100vh;         /* Que el contenido ocupe toda la altura */
    }
    button, input:not([type="file"]), select {
      touch-action: manipulation;
    }
    input[type="file"] {
      touch-action: auto;
    }
    /* Evitar zoom en m√≥vil al enfocar campos de texto */
    input[type="text"],
    input[type="search"],
    input[type="date"],
    input[type="number"],
    textarea,
    select {
      font-size: 18px !important;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <!-- React / Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- SheetJS for XLSX parsing -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const cn = (...xs) => xs.filter(Boolean).join(" ");
    const load = (k, fb) => { try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : fb; } catch { return fb; } };
    const save = (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} };
    const uid = () => Math.random().toString(36).slice(2, 9);
    const todayISO = () => new Date().toISOString().slice(0,10);
    const normalize = (t) => (t||"").toString().toLowerCase().normalize('NFD').replace(/[ÃÄ-ÕØ]/g,'');
    const formatEU = (s) => { if (!s) return ""; const [y,m,d] = String(s).split('-'); return (d&&m&&y) ? `${d}/${m}/${y}` : s; };

    // URL del backend para datos compartidos (Google Apps Script u otro)
    // Deja la cadena vac√≠a ("") para trabajar solo en modo local por dispositivo.
    const API_URL = ""; // <-- pega aqu√≠ la URL de tu Web App de Google Apps Script cuando la tengas

    async function loadSharedData() {
      if (!API_URL) return null;
      try {
        const res = await fetch(API_URL);
        const json = await res.json();
        if (!json || json.ok === false) {
          console.error("Error al cargar datos compartidos", json && json.error);
          return null;
        }
        const faltas = Array.isArray(json.faltas) ? json.faltas : [];
        const historico = Array.isArray(json.historico) ? json.historico : [];
        return { faltas, historico };
      } catch (e) {
        console.error("Error de red al cargar datos compartidos", e);
        return null;
      }
    }

    async function saveSharedData(faltas, historico) {
      if (!API_URL) return;
      try {
        await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ faltas, historico })
        });
      } catch (e) {
        console.error("Error de red al guardar datos compartidos", e);
      }
    }

    // ---------- Helpers ----------
    async function parseAnyFile(file) {
      const name = (file?.name||"").toLowerCase();
      if (name.endsWith(".xlsx") || name.endsWith(".xls")) {
        const data = await file.arrayBuffer();
        const wb = XLSX.read(data, { type: "array" });
        const ws = wb.Sheets[wb.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(ws, { defval: "" });
        const headers = Object.keys(rows[0]||{}).map(h=> String(h).toLowerCase());
        return { headers, rows };
      }
      const text = await file.text();
      const firstLine = text.split(/?
/)[0] || "";
      const candidates = [",", ";", "	"];
      let delim = ","; let maxParts = 0;
      for (const d of candidates) { const parts = firstLine.split(d).length; if (parts > maxParts) { maxParts = parts; delim = d; } }
      const lines = text.split(/?
/).filter(l => l.trim().length > 0);
      const parseLine = (line) => {
        const out = []; let cur = ""; let inQ = false;
        for (let i = 0; i < line.length; i++) {
          const ch = line[i];
          if (ch === '"') { if (inQ && line[i+1] === '"') { cur += '"'; i++; } else { inQ = !inQ; } }
          else if (ch === delim && !inQ) { out.push(cur); cur = ""; }
          else { cur += ch; }
        }
        out.push(cur);
        return out.map(s => s.trim());
      };
      const headerCells = parseLine(lines[0]).map(h => h.toLowerCase());
      const rows = lines.slice(1).map(line => { const cells = parseLine(line); const obj = {}; headerCells.forEach((h, i) => obj[h] = (cells[i] ?? "").trim()); return obj; });
      return { headers: headerCells, rows };
    }
    function downloadCSV(rows, filename) {
      if (!rows || rows.length===0) return;
      const headers = Object.keys(rows[0]);
      const esc = (s) => `"` + String(s).replace(/"/g,'""') + `"`;
      const csv = [headers.join(',')].concat(rows.map(r=> headers.map(h=>esc(r[h]??'')).join(','))).join('
');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.click();
      setTimeout(()=> URL.revokeObjectURL(url), 1000);
    }

    // ---------- Top UI ----------
    function TopBar({ onToggleSidebar }) {
      return (
        <header className="sticky top-0 z-30 w-full border-b bg-gradient-to-r from-emerald-700 to-emerald-600 text-white shadow">
          <div className="mx-auto flex max-w-7xl flex-wrap md:flex-nowrap items-center justify-between px-4 py-4 gap-2">
            <div className="flex items-center gap-3">
              <button
                onClick={onToggleSidebar}
                aria-label="Abrir/cerrar men√∫"
                className="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-white/10 text-white hover:bg-white/20 md:hidden">
                ‚ò∞
              </button>
              <div className="flex h-10 w-10 items-center justify-center rounded-xl bg-white/90 text-emerald-700 font-bold">
                SAS
              </div>
              <div className="text-xl font-semibold tracking-tight">
                MEDICAMENTOS SIN EXISTENCIAS
              </div>
              <span className="ml-2 rounded-full bg-white/20 px-2.5 py-1 text-xs md:text-sm">
                UGC de Farmacia ‚Äî AGS Campo de Gibraltar Oeste
              </span>
            </div>
            <div className="hidden md:flex items-center gap-3">
              <span className="text-sm opacity-90">Registro y regularizaci√≥n</span>
              <div className="h-8 w-8 rounded-md bg-white text-emerald-700 font-black grid place-items-center" title="Anagrama">
                U
              </div>
            </div>
          </div>
        </header>
      );
    }

    function Sidebar({ open, activeTab, onSelectTab, onOpenHistory }) {
      const items = [
        { id: "faltas", label: "Faltas", icon: "üö®" },
        { id: "config", label: "Configuraci√≥n", icon: "üóÇÔ∏è" },
        { id: "kpis", label: "Indicadores", icon: "üìä" },
        { id: "settings", label: "Ajustes", icon: "‚öôÔ∏è" },
      ];
      return (
        <aside
          className={cn(
            "fixed inset-y-0 left-0 z-20 w-72 bg-white/95 backdrop-blur border-r p-4 transition-transform duration-200 md:static md:translate-x-0",
            open ? "translate-x-0" : "-translate-x-full"
          )}
        >
          <div className="mb-3 px-2 text-sm text-gray-500">Navegaci√≥n</div>
          <nav className="space-y-1">
            {items.map((it) => (
              <button
                key={it.id}
                onClick={() => onSelectTab(it.id)}
                className={cn(
                  "flex w-full items-center gap-3 rounded-xl px-3 py-3 text-left text-base shadow-sm",
                  activeTab === it.id
                    ? "bg-emerald-600 text-white"
                    : "bg-white hover:bg-emerald-50 border"
                )}
              >
                <span className="text-lg">{it.icon}</span>
                <span className="font-medium">{it.label}</span>
              </button>
            ))}
            <div className="mt-2 pt-2 border-t">
              <button
                onClick={onOpenHistory}
                className="flex w-full items-center gap-3 rounded-xl px-3 py-3 text-left text-base shadow-sm bg-white hover:bg-emerald-50 border"
              >
                <span className="text-lg">üïò</span>
                <span className="font-medium">Hist√≥rico</span>
              </button>
            </div>
          </nav>
        </aside>
      );
    }

    const Card = ({children}) => (
      <div className="rounded-2xl border p-5 bg-white shadow-sm text-[1rem]">
        {children}
      </div>
    );

    // ---------- Hist√≥rico Global ----------
    function HistoryModal({ open, onClose, historico }) {
      if (!open) return null;
      return (
        <div className="fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4">
          <div className="w-full max-w-3xl rounded-2xl bg-white p-5 shadow-xl">
            <div className="flex items-center justify-between mb-3">
              <div className="text-lg font-semibold">Hist√≥rico de regularizaciones</div>
              <button
                onClick={onClose}
                className="rounded-lg border px-3 py-1 text-sm hover:bg-gray-50"
              >
                Cerrar
              </button>
            </div>
            <div className="overflow-auto max-h-[70vh] rounded-2xl border">
              <table className="w-full text-left text-base">
                <thead className="bg-emerald-50 text-sm text-emerald-700">
                  <tr>
                    <th className="p-3">Fecha</th>
                    <th className="p-3">Medicamento</th>
                  </tr>
                </thead>
                <tbody>
                  {historico.map((h)=> (
                    <tr key={h.id} className="border-t">
                      <td className="p-3 whitespace-nowrap">{formatEU(h.fecha)}</td>
                      <td className="p-3">{h.medicamento?.nombre}</td>
                    </tr>
                  ))}
                  {historico.length===0 && (
                    <tr>
                      <td className="p-3 text-center text-sm text-gray-500" colSpan={2}>
                        Sin registros en el hist√≥rico
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );
    }

    // ---------- Faltas View ----------
    function FaltasView({ pendientes, setPendientes, historico, setHistorico }) {
      const medsCatalog = load("medsCatalog", []);   // {codihospi, registrado, cn, nombre}
      const staffCatalog = load("staffCatalog", []); // {nombre, rol}

      const [showReg, setShowReg] = useState(false);
      const [regItem, setRegItem] = useState(null);

      const [form, setForm] = useState({
        fecha: todayISO(),
        medicamento: { codihospi: "", registrado: "", cn: "", nombre: "" },
        taf: ""
      });

      const [medInput, setMedInput] = useState("");
      const [medQuery, setMedQuery] = useState("");
      const medMatches = useMemo(()=> {
        const qn = normalize(medQuery.trim());
        if (!qn) return [];
        const starts = (s) => normalize(s).startsWith(qn);
        const contains = (s) => normalize(s).includes(qn);
        const scored = medsCatalog.map(m => {
          const sNombre = starts(m.nombre);
          const sCodi = starts(m.codihospi);
          const sCN = starts(m.cn);
          const sReg = starts(m.registrado);
          const cNombre = contains(m.nombre);
          const cCodi = contains(m.codihospi);
          const cCN = contains(m.cn);
          const cReg = contains(m.registrado);
          const score =
            (sNombre?100:0) + (sCodi?60:0) + (sCN?40:0) + (sReg?30:0) +
            (cNombre?10:0) + (cCodi?6:0) + (cCN?4:0) + (cReg?3:0);
          const hit = sNombre || sCodi || sCN || sReg || cNombre || cCodi || cCN || cReg;
          return { m, score, hit };
        })
          .filter(x=>x.hit)
          .sort((a,b)=> b.score - a.score)
          .slice(0,10)
          .map(x=>x.m);
        return scored;
      }, [medQuery, medsCatalog]);

      const selectMed = (m) => {
        const display = m.nombre || m.registrado || m.codihospi || m.cn || "";
        setForm((prev)=>({
          ...prev,
          medicamento: {
            codihospi: m.codihospi||"",
            registrado: m.registrado||"",
            cn: m.cn||"",
            nombre: m.nombre||""
          }
        }));
        setMedInput(display);
        setMedQuery("");
        if (document.activeElement) { document.activeElement.blur(); }
      };

      // B√∫squeda de personal por contiene (inteligente)
      const [staffQuery, setStaffQuery] = useState("");
      const staffFiltered = useMemo(() => {
        const qn = normalize(staffQuery.trim());
        if (!qn) return staffCatalog;
        return staffCatalog.filter(p => normalize(p.nombre).includes(qn));
      }, [staffCatalog, staffQuery]);

      const resolveTypedMedication = () => {
        const q = medQuery.trim().toLowerCase();
        if (!q) return null;
        if (medMatches.length === 1) return medMatches[0];
        const exact = medsCatalog.find(m =>
          (m.codihospi||"").toLowerCase() === q ||
          (m.nombre||"").toLowerCase() === q ||
          (m.cn||"").toLowerCase() === q ||
          (m.registrado||"").toLowerCase() === q
        );
        return exact || null;
      };

      const addFalta = () => {
        let { fecha, medicamento, taf } = form;
        if (!medicamento.codihospi) {
          const inferred = resolveTypedMedication();
          if (inferred) {
            medicamento = {
              codihospi: inferred.codihospi||"",
              registrado: inferred.registrado||"",
              cn: inferred.cn||"",
              nombre: inferred.nombre||""
            };
          }
        }
        if (!fecha || !medicamento.codihospi) return;
        const reg = { id: uid(), fecha, medicamento, taf, estado: "pendiente" };
        setPendientes((xs)=> [reg, ...xs]);
        setForm({
          fecha: todayISO(),
          medicamento: { codihospi:"", registrado:"", cn:"", nombre:"" },
          taf:""
        });
        setMedInput("");
        setMedQuery("");
      };

      const confirmRegularizar = ({ who, fecha, nota }) => {
        const item = regItem; if (!item) return;
        const mov = {
          id: uid(),
          fecha: fecha||todayISO(),
          medicamento: item.medicamento,
          personal: who||item.taf||"‚Äî",
          nota: nota||""
        };
        setHistorico((xs)=> [mov, ...xs]);
        setPendientes((xs)=> xs.filter((x)=> x.id!==item.id));
        setShowReg(false);
        setRegItem(null);
      };

      const [q, setQ] = useState("");
      const pendFiltradas = useMemo(()=> {
        const qn = normalize(q.trim());
        if (!qn) return pendientes;
        return pendientes.filter((r)=> {
          const nameN = normalize(r.medicamento.nombre);
          const codiN = normalize(r.medicamento.codihospi);
          const tafN = normalize(r.taf);
          // nombre por prefijo; CODIHOSPI por contiene; personal por contiene
          return nameN.startsWith(qn) || codiN.includes(qn) || tafN.includes(qn);
        });
      }, [pendientes,q]);

      return (
        <div className="space-y-6">
          <Card>
            <div className="text-sm font-medium mb-2">Campos a cumplimentar</div>
            <div className="grid gap-2 lg:grid-cols-6 sm:grid-cols-2">
              <input
                type="date"
                className="rounded-xl border px-4 py-3 text-base focus:ring-2 focus:ring-emerald-500 outline-none"
                value={form.fecha}
                onChange={(e)=>setForm({...form, fecha:e.target.value})}
              />
              <div className="lg:col-span-3">
                <input
                  type="text"
                  value={medInput}
                  onChange={(e)=>{
                    const v = e.target.value;
                    setMedInput(v);
                    setMedQuery(v);
                  }}
                  placeholder="Medicamento (nombre comercial, REGISTRADO, CN o CODIHOSPI)"
                  className="w-full rounded-xl border px-4 py-3 text-base focus:ring-2 focus:ring-emerald-500 outline-none"
                />
                {medMatches.length>0 && (
                  <div className="mt-1 max-h-56 overflow-auto rounded-xl border bg-white text-base z-20 relative">
                    {medMatches.map((m)=> (
                      <button
                        key={`${m.codihospi}-${m.cn}`}
                        className="block w-full px-3 py-2 text-left hover:bg-emerald-50"
                        onClick={()=>selectMed(m)}
                      >
                        <div className="font-medium">{m.nombre}</div>
                        <div className="text-xs text-gray-600">
                          CODIHOSPI {m.codihospi||"‚Äî"} ¬∑ REGISTRADO {m.registrado||"‚Äî"} ¬∑ CN {m.cn||"‚Äî"} ¬∑ NOMBRE COMERCIAL {m.nombre||"‚Äî"}
                        </div>
                      </button>
                    ))}
                  </div>
                )}
              </div>
              <div className="relative">
                <input
                  type="text"
                  value={form.taf || staffQuery}
                  onChange={(e)=>{
                    setStaffQuery(e.target.value);
                    setForm({...form, taf: e.target.value});
                  }}
                  placeholder="Personal (escritura inteligente por contiene)"
                  className="w-full rounded-xl border px-4 py-3 text-base focus:ring-2 focus:ring-emerald-500 outline-none"
                />
                {staffQuery.trim() && staffFiltered.length>0 && (
                  <div className="absolute z-30 mt-1 w-full max-h-56 overflow-auto rounded-xl border bg-white text-base">
                    {staffFiltered.map((p)=> (
                      <button
                        key={p.nombre}
                        type="button"
                        className="block w-full px-3 py-2 text-left hover:bg-emerald-50"
                        onClick={()=>{
                          setForm({...form, taf:p.nombre});
                          setStaffQuery(p.nombre);
                        }}
                      >
                        {p.nombre} ¬∑{" "}
                        <span className="text-xs text-gray-600">{p.rol}</span>
                      </button>
                    ))}
                  </div>
                )}
              </div>
            </div>
            <div className="mt-3">
              <button
                onClick={addFalta}
                className="w-full sm:w-auto rounded-xl bg-emerald-600 px-5 py-3 text-base text-white shadow hover:bg-emerald-700"
              >
                Registrar falta
              </button>
            </div>
          </Card>

          <div className="flex items-center justify-between">
            <h2 className="text-2xl font-semibold text-emerald-700">Medicamentos en falta</h2>
            <div className="flex items-center gap-2">
              <input
                value={q}
                onChange={(e)=>setQ(e.target.value)}
                placeholder="Buscar por nombre (prefijo), CODIHOSPI (contiene) o persona (contiene)‚Ä¶"
                className="rounded-xl border px-4 py-3 text-base"
              />
            </div>
          </div>

          <div className="overflow-auto rounded-2xl border">
            <table className="w-full text-left text-base">
              <thead className="bg-emerald-50 text-sm text-emerald-700">
                <tr>
                  <th className="p-3">Fecha</th>
                  <th className="p-3">CODIHOSPI</th>
                  <th className="p-3">Nombre</th>
                  <th className="p-3">Registrado por</th>
                  <th className="p-3 text-right">Regularizar</th>
                </tr>
              </thead>
              <tbody>
                {pendFiltradas.map((r)=> (
                  <tr key={r.id} className="border-t">
                    <td className="p-3 whitespace-nowrap">{formatEU(r.fecha)}</td>
                    <td className="p-3">{r.medicamento.codihospi}</td>
                    <td className="p-3">{r.medicamento.nombre}</td>
                    <td className="p-3">{r.taf || '‚Äî'}</td>
                    <td className="p-3 text-right">
                      <button
                        onClick={()=>{
                          setRegItem(r);
                          setShowReg(true);
                        }}
                        className="rounded-lg border px-3 py-2 text-sm hover:bg-emerald-50"
                      >
                        Regularizar
                      </button>
                    </td>
                  </tr>
                ))}
                {pendFiltradas.length===0 && (
                  <tr>
                    <td className="p-3 text-center text-sm text-gray-500" colSpan={5}>
                      Sin faltas pendientes
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>

          <RegularizarModal
            open={showReg}
            onClose={()=>setShowReg(false)}
            onConfirm={confirmRegularizar}
          />
        </div>
      );
    }

    // ---------- Regularizar Modal ----------
    function RegularizarModal({ open, onClose, onConfirm }) {
      const rawStaff = load("staffCatalog", []);
      const [who, setWho] = useState("");
      const [nota, setNota] = useState("");
      const [fecha, setFecha] = useState(()=> todayISO());
      const [staffQuery, setStaffQuery] = useState("");
      const staffFiltered = useMemo(() => {
        const qn = normalize(staffQuery.trim());
        if (!qn) return rawStaff;
        return rawStaff.filter(p => normalize(p.nombre).includes(qn));
      }, [rawStaff, staffQuery]);
      if (!open) return null;
      return (
        <div className="fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4">
          <div className="w-full max-w-lg rounded-2xl bg-white p-5 shadow-xl">
            <div className="text-lg font-semibold mb-2">Regularizar medicamento</div>
            <div className="grid gap-3">
              <div>
                <div className="text-xs text-gray-600 mb-1">Personal</div>
                <div className="relative">
                  <input
                    type="text"
                    value={who || staffQuery}
                    onChange={(e)=>{
                      setStaffQuery(e.target.value);
                      setWho(e.target.value);
                    }}
                    placeholder="Personal (escritura inteligente por contiene)"
                    className="w-full rounded-xl border px-3 py-2 text-sm"
                  />
                  {staffQuery.trim() && staffFiltered.length>0 && (
                    <div className="absolute z-30 mt-1 w-full max-h-56 overflow-auto rounded-xl border bg-white text-base">
                      {staffFiltered.map((p)=> (
                        <button
                          key={p.nombre}
                          type="button"
                          className="block w-full px-3 py-2 text-left hover:bg-emerald-50"
                          onClick={()=>{
                            setWho(p.nombre);
                            setStaffQuery(p.nombre);
                          }}
                        >
                          {p.nombre} ¬∑{" "}
                          <span className="text-xs text-gray-600">{p.rol}</span>
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              </div>
              <div>
                <div className="text-xs text-gray-600 mb-1">Fecha</div>
                <input
                  type="date"
                  className="w-full rounded-xl border px-3 py-2 text-sm"
                  value={fecha}
                  onChange={(e)=>setFecha(e.target.value)}
                />
              </div>
              <div>
                <div className="text-xs text-gray-600 mb-1">Nota / ID ATHOS</div>
                <input
                  className="w-full rounded-xl border px-3 py-2 text-sm"
                  placeholder="ID/nota de regularizaci√≥n"
                  value={nota}
                  onChange={(e)=>setNota(e.target.value)}
                />
              </div>
            </div>
            <div className="mt-4 flex justify-end gap-2">
              <button
                className="rounded-xl border px-4 py-2 text-sm"
                onClick={onClose}
              >
                Cancelar
              </button>
              <button
                className="rounded-xl bg-emerald-600 px-5 py-2 text-sm text-white"
                onClick={()=> onConfirm({ who, fecha, nota })}
              >
                Confirmar
              </button>
            </div>
          </div>
        </div>
      );
    }

    // ---------- Config View ----------
    function ConfigView() {
      const [medsCatalog, setMedsCatalog] = useState(() => load("medsCatalog", []));
      const [staffCatalog, setStaffCatalog] = useState(() => load("staffCatalog", []));
      const [fileHeaders, setFileHeaders] = useState({ meds: [], staff: [] });
      const [maps, setMaps] = useState({
        meds: { codihospi: "", registrado: "", cn: "", nombre: "" },
        staff: { nombre: "", rol: "" },
      });
      const [staging, setStaging] = useState({ meds: [], staff: [] });
      const [valReport, setValReport] = useState({ meds: [], staff: [] });

      const exportMedsCatalog = () => {
        if (!Array.isArray(medsCatalog) || medsCatalog.length === 0) return;
        const rows = medsCatalog.map(m => ({
          codihospi: m.codihospi || "",
          registrado: m.registrado || "",
          cn: m.cn || "",
          nombre: m.nombre || ""
        }));
        downloadCSV(rows, 'medicamentos_catalogo.csv');
      };

      const exportStaffCatalog = () => {
        if (!Array.isArray(staffCatalog) || staffCatalog.length === 0) return;
        const rows = staffCatalog.map(p => ({
          nombre: p.nombre || "",
          rol: p.rol || ""
        }));
        downloadCSV(rows, 'personal_catalogo.csv');
      };

      useEffect(()=>{ save("medsCatalog", medsCatalog); }, [medsCatalog]);
      useEffect(()=>{ save("staffCatalog", staffCatalog); }, [staffCatalog]);

      const guessMap = (headers, kind) => {
        const H = headers.map(h=>h.toLowerCase());
        const pick = (cands) => H.find(h => cands.includes(h)) || "";
        return kind === 'meds' ? {
          codihospi: pick(["codihospi","codigo hospi","codigo_hospi","cod_hospi","codihosp"]),
          registrado: pick(["registrado","estado registrado","es_registrado","esta registrado"]),
          cn: pick(["cn","c√≥digo nacional","codigo nacional","codigo_nacional"]),
          nombre: pick(["nombre comercial","nombre","nombre codihospi","descripcion","denominaci√≥n","denominacion"]),
        } : {
          nombre: pick(["nombre","apellidos nombre","nombre completo"]),
          rol: pick(["rol","perfil","cargo"]),
        };
      };

      const onUpload = async (kind, files) => {
        if (!files || files.length===0) return;
        let headersUnion = new Set();
        let allRows = [];
        for (const f of files) {
          const { headers, rows } = await parseAnyFile(f);
          headers.forEach(h=>headersUnion.add(h));
          allRows = allRows.concat(rows);
        }
        const headersArr = Array.from(headersUnion);
        setFileHeaders(prev => ({ ...prev, [kind]: headersArr }));
        setMaps(prev => ({ ...prev, [kind]: guessMap(headersArr, kind==='meds'?'meds':'staff') }));
        setStaging(prev => ({ ...prev, [kind]: allRows }));
        setValReport(prev => ({ ...prev, [kind]: [] }));
      };

      const applyMapping = (kind) => {
        const map = maps[kind];
        const rows = staging[kind];
        if (kind === 'meds') {
          const norm = rows.map(r=> {
            const lower = {};
            Object.entries(r||{}).forEach(([k, v]) => {
              lower[String(k).toLowerCase()] = v;
            });
            return {
              codihospi: lower[(map.codihospi||"").toLowerCase()]||"",
              registrado: lower[(map.registrado||"").toLowerCase()]||"",
              cn: lower[(map.cn||"").toLowerCase()]||"",
              nombre: lower[(map.nombre||"").toLowerCase()]||""
            };
          });
          const errs = [];
          const seen = new Set();
          const valid = norm.filter((x, idx) => {
            const missing = [];
            if (!x.codihospi) missing.push('codihospi');
            if (!x.nombre) missing.push('nombre');
            const key = (x.codihospi||'').toLowerCase();
            const dup = key && seen.has(key);
            if (dup) errs.push({ fila: idx+2, error: 'Duplicado CODIHOSPI', valor: x.codihospi });
            if (missing.length>0) errs.push({ fila: idx+2, error: 'Campos obligatorios', valor: missing.join(',') });
            if (!dup && key) seen.add(key);
            return missing.length===0 && !dup;
          });
          const merged = [...valid, ...medsCatalog].reduce((acc, cur) => {
            const k = (cur.codihospi||'').toLowerCase();
            if (!k) return acc;
            acc.set(k, { ...acc.get(k), ...cur });
            return acc;
          }, new Map());
          setMedsCatalog(Array.from(merged.values()));
          setValReport(prev => ({ ...prev, meds: errs }));
        } else {
          const norm = rows.map(r=> {
            const lower = {};
            Object.entries(r||{}).forEach(([k, v]) => {
              lower[String(k).toLowerCase()] = v;
            });
            return {
              nombre: lower[(map.nombre||"").toLowerCase()]||"",
              rol: (lower[(map.rol||"").toLowerCase()]||"").toUpperCase()
            };
          });
          const errs = [];
          const seen = new Set();
          const valid = norm.filter((x, idx) => {
            const missing = [];
            if (!x.nombre) missing.push('nombre');
            const key = `${(x.nombre||'').toLowerCase()}`;
            const dup = key && seen.has(key);
            if (dup) errs.push({ fila: idx+2, error: 'Duplicado nombre', valor: key });
            if (missing.length>0) errs.push({ fila: idx+2, error: 'Campos obligatorios', valor: missing.join(',') });
            if (!dup && key) seen.add(key);
            return missing.length===0 && !dup;
          });
          const merged = [...valid, ...staffCatalog].reduce((acc, cur) => {
            const k = `${(cur.nombre||'').toLowerCase()}`;
            if (!k) return acc;
            acc.set(k, { ...acc.get(k), ...cur });
            return acc;
          }, new Map());
          setStaffCatalog(Array.from(merged.values()));
          setValReport(prev => ({ ...prev, staff: errs }));
        }
      };

      return (
        <div className="space-y-6">
          {/* Medicamentos */}
          <Card>
            <div className="text-lg font-semibold mb-1">Cat√°logo de medicamentos</div>
            <div className="flex items-center justify-between gap-2">
              <p className="mt-1 text-sm text-gray-600">
                Sube uno o varios archivos <strong>CSV o XLSX</strong>. Columnas esperadas:
                <strong> CODIHOSPI</strong>, <strong>REGISTRADO</strong>, <strong>CN</strong>,
                <strong> NOMBRE COMERCIAL</strong>. Ajusta el <strong>mapa de columnas</strong> y aplica.
              </p>
              <div className="ml-4 hidden sm:flex items-center gap-2">
                <button
                  onClick={() => { save('medsCatalog', []); alert('Cat√°logo de medicamentos borrado.'); }}
                  className="rounded-xl border px-3 py-2 text-xs hover:bg-rose-50"
                >
                  Vaciar medicamentos
                </button>
                <button
                  onClick={() => { save('staffCatalog', []); alert('Cat√°logo de personal borrado.'); }}
                  className="rounded-xl border px-3 py-2 text-xs hover:bg-rose-50"
                >
                  Vaciar personal
                </button>
              </div>
            </div>
            <input
              type="file"
              accept=".csv,.xlsx,.xls"
              multiple
              className="mt-3 text-sm"
              onChange={(e)=> onUpload('meds', e.target.files)}
            />
            {fileHeaders.meds.length>0 && (
              <div className="mt-4 grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
                <div>
                  <div className="text-xs text-gray-600 mb-1">CODIHOSPI</div>
                  <select
                    className="w-full rounded-xl border px-3 py-2 text-sm"
                    value={maps.meds.codihospi}
                    onChange={(e)=>setMaps({...maps, meds:{...maps.meds, codihospi:e.target.value}})}
                  >
                    <option value="">‚Äî</option>
                    {fileHeaders.meds.map(h=> <option key={h} value={h}>{h}</option>)}
                  </select>
                </div>
                <div>
                  <div className="text-xs text-gray-600 mb-1">REGISTRADO</div>
                  <select
                    className="w-full rounded-xl border px-3 py-2 text-sm"
                    value={maps.meds.registrado}
                    onChange={(e)=>setMaps({...maps, meds:{...maps.meds, registrado:e.target.value}})}
                  >
                    <option value="">‚Äî</option>
                    {fileHeaders.meds.map(h=> <option key={h} value={h}>{h}</option>)}
                  </select>
                </div>
                <div>
                  <div className="text-xs text-gray-600 mb-1">CN</div>
                  <select
                    className="w-full rounded-xl border px-3 py-2 text-sm"
                    value={maps.meds.cn}
                    onChange={(e)=>setMaps({...maps, meds:{...maps.meds, cn:e.target.value}})}
                  >
                    <option value="">‚Äî</option>
                    {fileHeaders.meds.map(h=> <option key={h} value={h}>{h}</option>)}
                  </select>
                </div>
                <div>
                  <div className="text-xs text-gray-600 mb-1">NOMBRE COMERCIAL</div>
                  <select
                    className="w-full rounded-xl border px-3 py-2 text-sm"
                    value={maps.meds.nombre}
                    onChange={(e)=>setMaps({...maps, meds:{...maps.meds, nombre:e.target.value}})}
                  >
                    <option value="">‚Äî</option>
                    {fileHeaders.meds.map(h=> <option key={h} value={h}>{h}</option>)}
                  </select>
                </div>
                <div className="sm:col-span-2 lg:col-span-4 flex flex-wrap items-center gap-2">
                  <button
                    onClick={()=>applyMapping('meds')}
                    className="rounded-xl bg-emerald-600 px-5 py-3 text-sm text-white shadow hover:bg-emerald-700"
                  >
                    Aplicar mapeo
                  </button>
                  <button
                    onClick={exportMedsCatalog}
                    className="rounded-xl border px-4 py-2 text-sm hover:bg-emerald-50"
                  >
                    Exportar cat√°logo
                  </button>
                </div>
              </div>
            )}
            {valReport.meds.length>0 && (
              <div className="mt-3 rounded-xl border border-amber-300 bg-amber-50 p-3 text-sm">
                <div className="font-medium">Incidencias ({valReport.meds.length})</div>
                <button
                  className="mt-2 rounded-lg border px-3 py-2 text-xs hover:bg-amber-100"
                  onClick={()=>downloadCSV(valReport.meds, 'log_errores_meds.csv')}
                >
                  Descargar log
                </button>
              </div>
            )}
            <div className="mt-2 text-xs">Registros en cat√°logo: {medsCatalog.length}</div>
          </Card>

          {/* Personal */}
          <Card>
            <div className="text-lg font-semibold mb-1">Personal</div>
            <p className="mt-1 text-sm text-gray-600">
              CSV/XLSX, m√∫ltiples ficheros. Ajusta el mapa de columnas y aplica. Recuerda que cada dispositivo
              (PC, m√≥vil) guarda su propio cat√°logo en local.
            </p>
            <input
              type="file"
              accept=".csv,.xlsx,.xls"
              multiple
              className="mt-3 text-sm"
              onChange={(e)=> onUpload('staff', e.target.files)}
            />
            {fileHeaders.staff.length>0 && (
              <div className="mt-4 grid gap-3 sm:grid-cols-3 lg:grid-cols-6">
                <div className="lg:col-span-3">
                  <div className="text-xs text-gray-600 mb-1">Nombre</div>
                  <select
                    className="w-full rounded-xl border px-3 py-2 text-sm"
                    value={maps.staff.nombre}
                    onChange={(e)=>setMaps({...maps, staff:{...maps.staff, nombre:e.target.value}})}
                  >
                    <option value="">‚Äî</option>
                    {fileHeaders.staff.map(h=> <option key={h} value={h}>{h}</option>)}
                  </select>
                </div>
                <div className="lg:col-span-3">
                  <div className="text-xs text-gray-600 mb-1">Rol</div>
                  <select
                    className="w-full rounded-xl border px-3 py-2 text-sm"
                    value={maps.staff.rol}
                    onChange={(e)=>setMaps({...maps, staff:{...maps.staff, rol:e.target.value}})}
                  >
                    <option value="">‚Äî</option>
                    {fileHeaders.staff.map(h=> <option key={h} value={h}>{h}</option>)}
                  </select>
                </div>
                <div className="sm:col-span-3 flex items-center gap-2">
                  <button
                    onClick={()=>applyMapping('staff')}
                    className="rounded-xl bg-emerald-600 px-5 py-3 text-sm text-white shadow hover:bg-emerald-700"
                  >
                    Aplicar mapeo
                  </button>
                  <button
                    onClick={exportStaffCatalog}
                    className="rounded-xl border px-4 py-2 text-sm hover:bg-emerald-50"
                  >
                    Exportar cat√°logo
                  </button>
                </div>
              </div>
            )}
            {valReport.staff.length>0 && (
              <div className="mt-3 rounded-2xl border border-amber-300 bg-amber-50 p-3 text-sm">
                <div className="font-medium">Incidencias ({valReport.staff.length})</div>
                <button
                  className="mt-2 rounded-lg border px-3 py-2 text-xs hover:bg-amber-100"
                  onClick={()=>downloadCSV(valReport.staff, 'log_errores_personal.csv')}
                >
                  Descargar log
                </button>
              </div>
            )}
            <div className="mt-2 text-xs">Registros en cat√°logo: {staffCatalog.length}</div>
          </Card>
        </div>
      );
    }

    // ---------- KPIs ----------
    function KPIsView({ pendientes, historico }) {
      const disp = pendientes || [];
      const hist = historico || [];
      const [showHist, setShowHist] = React.useState(false);
      const [person, setPerson] = React.useState('');
      const [from, setFrom] = React.useState('');
      const [to, setTo] = React.useState('');

      const filtered = React.useMemo(() => {
        return hist.filter(h => {
          const okPerson = person ? normalize(h.personal).includes(normalize(person)) : true;
          const d = h.fecha || '';
          const okFrom = from ? d >= from : true;
          const okTo = to ? d <= to : true;
          return okPerson && okFrom && okTo;
        });
      }, [hist, person, from, to]);

      const exportCSV = () => {
        const rows = filtered.map(h => ({
          fecha: h.fecha,
          codihospi: h.medicamento?.codihospi || '',
          nombre: h.medicamento?.nombre || '',
          personal: h.personal || '',
          nota: h.nota || ''
        }));
        downloadCSV(rows, 'historico_regularizaciones.csv');
      };

      return (
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <h2 className="text-2xl font-semibold text-emerald-700">Indicadores</h2>
            <button
              onClick={() => setShowHist(true)}
              className="rounded-xl border px-4 py-2 text-sm hover:bg-emerald-50"
            >
              Hist√≥rico
            </button>
          </div>
          <div className="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
            <div className="rounded-2xl border p-5 bg-white shadow-sm">
              <div className="text-sm text-gray-600">Faltas abiertas</div>
              <div className="mt-1 text-3xl font-semibold">{disp.length}</div>
            </div>
            <div className="rounded-2xl border p-5 bg-white shadow-sm">
              <div className="text-sm text-gray-600">Hoy</div>
              <div className="mt-1 text-3xl font-semibold">{todayISO()}</div>
            </div>
          </div>

          {showHist && (
            <div className="fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4">
              <div className="w-full max-w-5xl rounded-2xl bg-white p-5 shadow-xl">
                <div className="flex items-center justify-between mb-3">
                  <div className="text-lg font-semibold">Hist√≥rico de medicamentos regularizados</div>
                  <div className="flex items-center gap-2">
                    <button
                      onClick={exportCSV}
                      className="rounded-lg border px-3 py-1 text-sm hover:bg-emerald-50"
                    >
                      Descargar CSV
                    </button>
                    <button
                      onClick={() => setShowHist(false)}
                      className="rounded-lg border px-3 py-1 text-sm hover:bg-gray-50"
                    >
                      Cerrar
                    </button>
                  </div>
                </div>

                <div className="mb-3 grid gap-2 sm:grid-cols-3">
                  <input
                    type="date"
                    value={from}
                    onChange={e=>setFrom(e.target.value)}
                    className="rounded-xl border px-3 py-2 text-sm"
                    placeholder="Desde"
                  />
                  <input
                    type="date"
                    value={to}
                    onChange={e=>setTo(e.target.value)}
                    className="rounded-xl border px-3 py-2 text-sm"
                    placeholder="Hasta"
                  />
                  <input
                    value={person}
                    onChange={e=>setPerson(e.target.value)}
                    className="rounded-xl border px-3 py-2 text-sm"
                    placeholder="Filtrar por persona"
                  />
                </div>

                <div className="overflow-auto max-h-[70vh] rounded-2xl border">
                  <table className="w-full text-left text-base">
                    <thead className="bg-emerald-50 text-sm text-emerald-700">
                      <tr>
                        <th className="p-3">Fecha</th>
                        <th className="p-3">CODIHOSPI</th>
                        <th className="p-3">Nombre</th>
                        <th className="p-3">Personal</th>
                        <th className="p-3">Nota</th>
                      </tr>
                    </thead>
                    <tbody>
                      {filtered.map((h) => (
                        <tr key={h.id} className="border-t">
                          <td className="p-3 whitespace-nowrap">{h.fecha}</td>
                          <td className="p-3">{h.medicamento?.codihospi}</td>
                          <td className="p-3">{h.medicamento?.nombre}</td>
                          <td className="p-3">{h.personal || '‚Äî'}</td>
                          <td className="p-3">{h.nota || ''}</td>
                        </tr>
                      ))}
                      {filtered.length===0 && (
                        <tr>
                          <td className="p-3 text-center text-sm text-gray-500" colSpan={5}>
                            Sin registros con esos filtros
                          </td>
                        </tr>
                      )}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // ---------- Settings ----------
    function SettingsView({ theme, setTheme, onWipeAll }) {
      const [role, setRole] = useState(()=> load('currentRole', 'FARMACEUTICO'));
      useEffect(()=> save('currentRole', role), [role]);
      const [brand, setBrand] = useState(()=> load('brandColor', '#007C59'));
      useEffect(()=> save('brandColor', brand), [brand]);

      const wipeMeds = () => { save('medsCatalog', []); alert('Cat√°logo de medicamentos borrado.'); };
      const wipeStaff = () => { save('staffCatalog', []); alert('Cat√°logo de personal borrado.'); };

      return (
        <div className="space-y-4">
          <h2 className="text-2xl font-semibold text-emerald-700">Ajustes</h2>
          <div className="rounded-2xl border p-5 bg-white shadow-sm grid gap-3 sm:grid-cols-2">
            <div>
              <div className="text-sm font-medium">Tema</div>
              <div className="mt-2 flex items-center gap-2">
                {['light', 'dim', 'dark'].map((t) => (
                  <button
                    key={t}
                    onClick={() => setTheme(t)}
                    className={cn(
                      "rounded-xl border px-3 py-2 text-base capitalize",
                      theme === t ? "bg-emerald-600 text-white" : "hover:bg-emerald-50"
                    )}
                  >
                    {t}
                  </button>
                ))}
              </div>
            </div>
            <div>
              <div className="text-sm font-medium">Rol actual</div>
              <select
                className="mt-2 w-full rounded-xl border px-3 py-2 text-base"
                value={role}
                onChange={(e)=>setRole(e.target.value)}
              >
                <option>TAF</option>
                <option>FARMACEUTICO</option>
              </select>
              <p className="mt-1 text-xs text-gray-600">
                El bot√≥n Regularizar est√° siempre disponible.
              </p>
            </div>
            <div>
              <div className="text-sm font-medium">Color corporativo</div>
              <input
                type="color"
                className="mt-2 w-24 h-10 rounded"
                value={brand}
                onChange={(e)=>setBrand(e.target.value)}
              />
              <p className="mt-1 text-xs text-gray-600">
                Por defecto, verde SAS (#007C59).
              </p>
            </div>
          </div>

          <div className="rounded-2xl border p-5 bg-white shadow-sm">
            <div className="text-sm font-medium mb-2">Acciones r√°pidas</div>
            <div className="flex flex-wrap gap-2">
              <button
                onClick={wipeMeds}
                className="rounded-xl border px-4 py-2 text-sm hover:bg-rose-50"
              >
                Borrar cat√°logo de medicamentos
              </button>
              <button
                onClick={wipeStaff}
                className="rounded-xl border px-4 py-2 text-sm hover:bg-rose-50"
              >
                Borrar cat√°logo de personal
              </button>
              <button
                onClick={onWipeAll}
                className="rounded-2xl bg-rose-600 px-4 py-2 text-white text-sm"
              >
                Borrar TODO (incluye faltas e hist√≥rico)
              </button>
            </div>
            <p className="mt-2 text-xs text-gray-600">
              Recuerda: los cat√°logos de medicamentos y personal se guardan en este dispositivo/navegador.
              Las faltas e hist√≥rico pueden compartirse entre usuarios si configuras un backend en API_URL.
            </p>
          </div>
        </div>
      );
    }

    // ---------- App ----------
    function App() {
      const [sidebarOpen, setSidebarOpen] = useState(false);
      const [activeTab, setActiveTab] = useState("faltas");
      const [theme, setTheme] = useState(() => load("theme", "light"));
      const [showGlobalHist, setShowGlobalHist] = useState(false);
      const [faltasPend, setFaltasPend] = useState(() => load("faltasPend", []));
      const [faltasHist, setFaltasHist] = useState(() => load("faltasHist", []));
      useEffect(() => { save("theme", theme); }, [theme]);

      // Semillas de ejemplo solo para cat√°logos locales (medicamentos y personal)
      useEffect(() => {
        try {
          const medsRaw = localStorage.getItem("medsCatalog");
          const staffRaw = localStorage.getItem("staffCatalog");
          const meds = medsRaw ? JSON.parse(medsRaw) : [];
          const staff = staffRaw ? JSON.parse(staffRaw) : [];
          if (!Array.isArray(meds) || meds.length === 0) {
            save("medsCatalog", [
              {
                codihospi: "DAPTO500",
                registrado: "S√≠",
                cn: "681234.5",
                nombre: "Daptomicina 500 mg vial"
              },
              {
                codihospi: "TRASTU-SC",
                registrado: "S√≠",
                cn: "712345.6",
                nombre: "Trastuzumab SC 600 mg"
              },
              {
                codihospi: "AMOXI875",
                registrado: "S√≠",
                cn: "",
                nombre: "Amoxicilina/√Åcido clavul√°nico 875/125"
              }
            ]);
          }
          if (!Array.isArray(staff) || staff.length === 0) {
            save("staffCatalog", [
              { nombre: "Mar√≠a L√≥pez", rol: "TAF" },
              { nombre: "Pedro Ruiz", rol: "TAF" },
              { nombre: "J. R. √Åvila", rol: "FARMACEUTICO" },
            ]);
          }
        } catch (e) { /* noop */ }
      }, []);

      // Carga inicial de datos compartidos (faltas e hist√≥rico)
      useEffect(() => {
        if (!API_URL) return;
        (async () => {
          try {
            const data = await loadSharedData();
            if (data && Array.isArray(data.faltas)) {
              setFaltasPend(data.faltas);
            }
            if (data && Array.isArray(data.historico)) {
              setFaltasHist(data.historico);
            }
          } catch (e) {
            console.error("Error al cargar datos compartidos al iniciar la app", e);
          }
        })();
      }, []);

      // Sincroniza cambios locales con el backend compartido
      useEffect(() => {
        save("faltasPend", faltasPend);
        save("faltasHist", faltasHist);
        if (!API_URL) return;
        (async () => {
          try {
            await saveSharedData(faltasPend, faltasHist);
          } catch (e) {
            console.error("Error al guardar datos compartidos", e);
          }
        })();
      }, [faltasPend, faltasHist]);

      const handleSelectTab = (id) => {
        setActiveTab(id);
        setSidebarOpen(false);                 // cerrar men√∫ al pulsar
        window.scrollTo({ top: 0, behavior: "smooth" }); // llevar vista arriba
      };

      const handleWipeAll = () => {
        setFaltasPend([]);
        setFaltasHist([]);
        save("medsCatalog", []);
        save("staffCatalog", []);
        alert("Cat√°logos, faltas pendientes e hist√≥rico borrados.");
      };

      return (
        <div
          className={cn(
            "min-h-screen text-gray-900",
            theme === "dim" && "bg-gray-100",
            theme === "dark" && "bg-gray-950 text-gray-100"
          )}
        >
          <TopBar onToggleSidebar={() => setSidebarOpen((v) => !v)} />
          <HistoryModal open={showGlobalHist} onClose={() => setShowGlobalHist(false)} historico={faltasHist} />
          <div className="mx-auto grid max-w-7xl grid-cols-1 md:grid-cols-[18rem_1fr]">
            <Sidebar
              open={sidebarOpen}
              activeTab={activeTab}
              onSelectTab={handleSelectTab}
              onOpenHistory={() => {
                setShowGlobalHist(true);
                setSidebarOpen(false);
              }}
            />
            <main className="min-h-[calc(100vh-4rem)] p-4 md:p-6 space-y-6 text-[1rem]">
              {activeTab === "faltas" && (
                <FaltasView
                  pendientes={faltasPend}
                  setPendientes={setFaltasPend}
                  historico={faltasHist}
                  setHistorico={setFaltasHist}
                />
              )}
              {activeTab === "config" && <ConfigView />}
              {activeTab === "kpis" && (
                <KPIsView
                  pendientes={faltasPend}
                  historico={faltasHist}
                />
              )}
              {activeTab === "settings" && (
                <SettingsView
                  theme={theme}
                  setTheme={setTheme}
                  onWipeAll={handleWipeAll}
                />
              )}
              <footer className="pt-6 text-center text-xs text-gray-500">
                v15 ‚Äî Ajustes espec√≠ficos para m√≥vil: letra algo mayor, men√∫ lateral que se oculta al pulsar,
                vista que sube al cambiar de pesta√±a y aviso de que los cat√°logos son locales por dispositivo.
              </footer>
            </main>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
